<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastrar Produto | Admin Dark</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input:focus, select:focus, textarea:focus {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
        select option {
            background-color: #1e293b;
            color: #f1f5f9;
        }
    </style>
</head>
<body class="bg-[#0f172a] p-8 flex justify-center min-h-screen items-center font-sans text-slate-100">
    
    <div class="w-full max-w-md bg-[#1e293b] shadow-2xl rounded-2xl p-8 border border-slate-700">
        <div class="mb-8 text-center md:text-left">
            <h2 class="text-2xl font-bold tracking-tight">Novo Produto</h2>
            <p class="text-slate-400 text-sm mt-1">Organize seu estoque por finalidade de uso.</p>
        </div>
        
        <form id="formCadastro" class="space-y-5">
            <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-[0.15em] mb-2">Nome do Produto</label>
                <input type="text" id="nome" 
                    class="w-full bg-[#0f172a] border border-slate-700 rounded-lg p-3 text-slate-100 placeholder-slate-600 focus:bg-[#1e293b] transition-all outline-none" 
                    placeholder="Ex: Monitor UltraWide 4K" required>
            </div>

            <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-[0.15em] mb-2">Categoria de Uso</label>
                <select id="categoria" 
                    class="w-full bg-[#0f172a] border border-slate-700 rounded-lg p-3 text-slate-100 focus:bg-[#1e293b] transition-all outline-none appearance-none cursor-pointer">
                    <option value="Jogos">Jogos (Alta Performance)</option>
                    <option value="Escritório">Escritório (Produtividade)</option>
                    <option value="Estudos">Estudos (Funcionalidade)</option>
                    <option value="Acessórios">Acessórios (Estilo & LED)</option>
                </select>
            </div>

            <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-[0.15em] mb-2">Descrição do Produto</label>
                <textarea id="descricao" rows="3"
                    class="w-full bg-[#0f172a] border border-slate-700 rounded-lg p-3 text-slate-100 placeholder-slate-600 focus:bg-[#1e293b] transition-all outline-none resize-none" 
                    placeholder="Digite a descrição do produto..."></textarea>
            </div>

            <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-[0.15em] mb-2">Preço (R$)</label>
                <input type="text" id="preco" 
                    class="w-full bg-[#0f172a] border border-slate-700 rounded-lg p-3 text-slate-100 placeholder-slate-600 focus:bg-[#1e293b] transition-all outline-none" 
                    placeholder="0,00" required>
            </div>

            <div class="flex flex-col gap-3 pt-6">
                <button type="submit" 
                    class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3.5 rounded-xl font-bold transition-all shadow-lg shadow-blue-900/20 active:scale-[0.97]">
                    Confirmar Cadastro
                </button>
                
                <a href="produtos.html" 
                    class="w-full text-center bg-slate-800 text-slate-400 py-3.5 rounded-xl font-semibold text-sm transition-all 
                           hover:bg-red-600/20 hover:text-red-500 hover:border-red-600/50 border border-transparent
                           active:bg-red-600 active:text-white">
                    Cancelar e Voltar
                </a>
            </div>
        </form>
    </div>

    <script>
        const form = document.getElementById('formCadastro');
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); 

            // CAPTURA E CONVERSÃO DO PREÇO
            const precoOriginal = document.getElementById('preco').value;
            // Troca a vírgula pelo ponto antes de enviar para o servidor
            const precoFormatado = precoOriginal.replace(',', '.');

            const novoProduto = {
                nome: document.getElementById('nome').value,
                categoria: document.getElementById('categoria').value,
                descricao: document.getElementById('descricao').value,
                preco: precoFormatado // Enviamos o preço já corrigido
            };

            try {
                const resposta = await fetch('http://localhost:3000/produtos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(novoProduto) 
                });
                
                if (resposta.ok) {
                    alert("Produto registrado com sucesso!");
                    window.location.href = 'produtos.html'; 
                } else {
                    const erroServidor = await resposta.json();
                    alert("Erro ao cadastrar: " + (erroServidor.mensagem || "Verifique os dados."));
                }
            } catch (erro) {
                alert("Erro: Servidor Offline.");
            }
        });
    </script>
</body>
</html>